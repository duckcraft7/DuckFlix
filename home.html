<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuckFlix - Carregando...</title>
    
    <link rel="stylesheet" href="style.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <style>
        .movie-card.focused {
            transform: scale(1.08);
            border: 4px solid #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            z-index: 10;
        }
    </style>
</head>
<body>

    <header class="main-header">
        <h1>DuckFlix</h1>
        <p>Seu cinema particular.</p>
    </header>

    <main id="catalog-container">
        <h2>Carregando catálogo...</h2>
    </main>

    <footer class="main-footer">
        <p>&copy; 2025 DuckFlix. Feito com ❤️ para os amantes de cinema.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // ---- PASSO 1: DEFINA O LINK PARA SUA LISTA JSON ----
            // SUBSTITUA PELO SEU LINK "RAW" PÚBLICO (GIST OU REPOSITÓRIO PÚBLICO)
            const listaUrl = 'https://duckflix-lista.vercel.app/list.json'; 

            const catalogContainer = document.getElementById('catalog-container');

            // ---- PASSO 2: BUSCAR E CONSTRUIR O CATÁLOGO ----
            fetch(listaUrl)
                .then(response => {
                    // Verifica se a requisição foi bem sucedida
                    if (!response.ok) {
                        throw new Error(`Erro HTTP! status: ${response.status}`);
                    }
                    return response.json(); // Converte a resposta para JSON
                })
                .then(data => {
                    catalogContainer.innerHTML = ''; // Limpa a mensagem "Carregando..."

                    // Itera sobre cada categoria na lista JSON
                    data.categorias.forEach(categoria => {
                        // Cria a seção da categoria
                        const section = document.createElement('section');
                        section.className = 'movie-section';

                        // Cria o título da categoria
                        const title = document.createElement('h2');
                        title.textContent = categoria.titulo;
                        section.appendChild(title);

                        // Cria a grade para os itens (filmes/séries)
                        const grid = document.createElement('div');
                        grid.className = 'movie-grid';

                        // Itera sobre cada item (filme/série) dentro da categoria
                        categoria.items.forEach(item => {
                            // Cria o link (card) para o item
                            const cardLink = document.createElement('a');
                            cardLink.className = 'movie-card';
                            cardLink.href = item.playerUrl; // Link para a página do player
                            cardLink.target = '_blank'; // Abrir em nova aba (opcional para TV)

                            // Preenche o conteúdo do card com HTML
                            cardLink.innerHTML = `
                                <img src="${item.poster}" alt="Pôster de ${item.titulo}">
                                <div class="movie-info">
                                    <h3>${item.titulo}</h3>
                                    <p>${item.ano}</p>
                                </div>
                            `;
                            grid.appendChild(cardLink); // Adiciona o card à grade
                        });

                        section.appendChild(grid); // Adiciona a grade à seção
                        catalogContainer.appendChild(section); // Adiciona a seção ao container principal
                    });

                    // ---- PASSO 3: ATIVAR A NAVEGAÇÃO APÓS CARREGAR ----
                    setupNavigation();
                })
                .catch(error => {
                    // Exibe uma mensagem de erro se não conseguir carregar a lista
                    console.error('Erro detalhado ao carregar a lista:', error);
                    catalogContainer.innerHTML = '<h2>Erro ao carregar o catálogo. Verifique o link da lista ou sua conexão.</h2>';
                });

            // ---- PASSO 4: FUNÇÃO DE NAVEGAÇÃO (COM BOTÃO OK CORRIGIDO) ----
            function setupNavigation() {
                const movieCards = document.querySelectorAll('.movie-card');
                if (movieCards.length === 0) return; // Sai se não houver cards

                let currentFocusIndex = 0;

                const setFocus = (index) => {
                    // Validação para evitar erros se o índice estiver fora dos limites
                    if (index < 0 || index >= movieCards.length) return; 

                    movieCards[currentFocusIndex].classList.remove('focused');
                    currentFocusIndex = index;
                    movieCards[currentFocusIndex].classList.add('focused');
                    // Rola a tela suavemente para manter o card focado visível
                    movieCards[currentFocusIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });
                };

                document.addEventListener('keydown', (event) => {
                    // Previne o comportamento padrão das teclas de seta/Enter
                    event.preventDefault(); 
                    
                    const grid = movieCards[currentFocusIndex].closest('.movie-grid'); // Encontra a grade do card atual
                    if (!grid) return; // Sai se não encontrar a grade
                    
                    const gridStyle = window.getComputedStyle(grid);
                    const gridColumnCount = gridStyle.getPropertyValue('grid-template-columns').split(' ').length;

                    switch (event.key) {
                        case 'ArrowRight':
                            // Move para a direita, mas não sai da linha atual se for o último da linha
                            const isLastInRow = (currentFocusIndex + 1) % gridColumnCount === 0;
                            if (currentFocusIndex < movieCards.length - 1 && !isLastInRow) {
                                setFocus(currentFocusIndex + 1);
                            } else if (currentFocusIndex < movieCards.length - 1 && isLastInRow) {
                                // Opcional: Poderia ir para o primeiro da próxima linha, se existir
                            }
                            break;
                        case 'ArrowLeft':
                             // Move para a esquerda, mas não sai da linha atual se for o primeiro da linha
                            const isFirstInRow = currentFocusIndex % gridColumnCount === 0;
                             if (currentFocusIndex > 0 && !isFirstInRow) {
                                setFocus(currentFocusIndex - 1);
                             }
                            break;
                        case 'ArrowDown':
                            const targetIndexDown = currentFocusIndex + gridColumnCount;
                            if (targetIndexDown < movieCards.length) {
                                setFocus(targetIndexDown);
                            }
                            break;
                        case 'ArrowUp':
                             const targetIndexUp = currentFocusIndex - gridColumnCount;
                            if (targetIndexUp >= 0) {
                                setFocus(targetIndexUp);
                            }
                            break;
                        case 'Enter':
                            const targetUrl = movieCards[currentFocusIndex].getAttribute('href');
                            if (targetUrl) {
                                window.location.href = targetUrl; // Navegação direta
                            }
                            break;
                    }
                });

                // Define o foco inicial no primeiro card quando a página carrega
                setFocus(0);
            }
        });
    </script>
</body>
</html>

