<script>
    // =========================================================
    // === CONFIGURA칂칏ES GLOBAIS ===
    // =========================================================
    // Sua URL de cat치logo confirmada no Vercel
    const listaUrl = '**https://duckflix-lista.vercel.app/lista.json**'; 
    
    // Nome da chave usada no localStorage (para verificar se o usu치rio est치 logado)
    const AUTH_KEY = 'duckflix_auth_pin';
    const LOGIN_PAGE = 'index.html'; 

    // =========================================================
    // === FUN칂츾O DE BUSCA E EMBUTIMENTO DO V칈DEO ===
    // =========================================================

    // Fun칞칚o para extrair o ID do filme da URL (ex: "narnia1" de "?id=narnia1")
    function getMovieIdFromUrl() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
    }
    
    // Fun칞칚o principal que carrega o filme
    async function loadPlayer() {
        const movieId = getMovieIdFromUrl();
        const titleElement = document.getElementById('movie-title');
        const videoElement = document.getElementById('video-tag');
        const messageElement = document.getElementById('loading-message');

        // 游뚿 Seguran칞a: Se a sess칚o n칚o estiver salva, redireciona para o login
        if (!localStorage.getItem(AUTH_KEY)) {
            window.location.href = LOGIN_PAGE;
            return;
        }

        if (!movieId) {
            titleElement.textContent = 'Erro: Filme n칚o especificado.';
            messageElement.textContent = 'Retorne ao cat치logo para selecionar um filme.';
            return;
        }

        try {
            // 1. Busca a lista de filmes do Vercel
            const response = await fetch(listaUrl);
            if (!response.ok) throw new Error('Falha ao buscar cat치logo. C칩digo: ' + response.status);
            const data = await response.json();

            // 2. Procura o filme pelo ID em todas as categorias
            let movieItem = null;
            data.categorias.forEach(categoria => {
                const found = categoria.items.find(item => item.id === movieId);
                if (found) {
                    movieItem = found;
                }
            });

            if (movieItem) {
                titleElement.textContent = movieItem.titulo;
                messageElement.style.display = 'none'; 
                
                // 3. Imbuti o link de v칤deo (MP4) na tag <video>
                videoElement.src = movieItem.videoLink;
                videoElement.poster = movieItem.poster; 
                videoElement.load(); 
                
                // Tenta iniciar a reprodu칞칚o automaticamente (pode ser bloqueado)
                videoElement.play().catch(e => console.log("Auto-play bloqueado. O usu치rio deve clicar play.")); 

            } else {
                titleElement.textContent = 'Erro: Filme n칚o encontrado no cat치logo.';
                messageElement.textContent = `ID do filme (${movieId}) n칚o encontrado na lista.json.`;
            }

        } catch (error) {
            console.error('Erro ao carregar o player:', error);
            titleElement.textContent = 'Falha cr칤tica ao carregar o player.';
            messageElement.textContent = `Detalhes: ${error.message}.`;
        }
    }

    // =========================================================
    // === INICIALIZA칂츾O ===
    // =========================================================
    document.addEventListener('DOMContentLoaded', loadPlayer);
</script>
