<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistindo | DuckFlix</title>
    <link rel="stylesheet" href="style.css"> 
    <style>
        /* Estilos básicos para o player */
        body { background-color: #000; color: white; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        .player-container { width: 90%; max-width: 1280px; margin-top: 50px; }
        h1 { color: #FFD700; margin-bottom: 10px; }
        .video-player { width: 100%; height: auto; aspect-ratio: 16 / 9; background-color: #000; border: none; }
    </style>
</head>
<body>

    <div class="player-container">
        <h1 id="movie-title">Carregando filme...</h1>
        
        <video id="video-tag" class="video-player" controls autoplay>
            Seu navegador não suporta a tag de vídeo.
        </video>

        <p id="loading-message" style="text-align: center; margin-top: 20px;">
            Iniciando o streaming seguro...
        </p>
    </div>

    <script>
        // Configurações (A mesma URL de lista do seu home.html)
        const listaUrl = '**https://duckflix-lista.vercel.app/lista.json**'; 

        // Função para extrair o ID da URL (ex: "narnia1" de "?id=narnia1")
        function getMovieIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        async function loadPlayer() {
            const movieId = getMovieIdFromUrl();
            const titleElement = document.getElementById('movie-title');
            const videoElement = document.getElementById('video-tag');
            const messageElement = document.getElementById('loading-message');

            if (!movieId) {
                titleElement.textContent = 'Erro: Filme não especificado.';
                messageElement.textContent = 'Retorne ao catálogo para selecionar um filme.';
                return;
            }

            try {
                // 1. Busca a lista de filmes do Vercel
                const response = await fetch(listaUrl);
                if (!response.ok) throw new Error('Falha ao buscar catálogo.');
                const data = await response.json();

                // 2. Procura o filme pelo ID em todas as categorias
                let movieItem = null;
                data.categorias.forEach(categoria => {
                    const found = categoria.items.find(item => item.id === movieId);
                    if (found) {
                        movieItem = found;
                    }
                });

                if (movieItem) {
                    titleElement.textContent = movieItem.titulo;
                    messageElement.style.display = 'none'; // Esconde a mensagem
                    
                    // 3. Imbuti o link de download direto na tag <video>
                    videoElement.src = movieItem.videoLink;
                    videoElement.poster = movieItem.poster; // Define o pôster
                    videoElement.load(); // Inicia o carregamento
                } else {
                    titleElement.textContent = 'Erro: Filme não encontrado no catálogo.';
                }

            } catch (error) {
                console.error('Erro ao carregar o player:', error);
                titleElement.textContent = 'Falha crítica ao carregar o player.';
                messageElement.textContent = `Detalhes: ${error.message}. Verifique a URL e o CORS do Vercel.`;
            }
        }

        document.addEventListener('DOMContentLoaded', loadPlayer);
    </script>
</body>
</html>
